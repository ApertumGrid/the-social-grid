<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval'; script-src * 'unsafe-inline' 'unsafe-eval'; connect-src * 'unsafe-inline'; img-src * data: blob: 'unsafe-inline'; style-src * 'unsafe-inline';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Social Grid | Powered by Apertum</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #00ffd5; --bright-blue: #0077ff; --glass: rgba(255, 255, 255, 0.05); }
        body { background: radial-gradient(circle at 50% 50%, #1a2a44 0%, #050a14 100%); background-attachment: fixed; color: #fff; margin: 0; font-family: 'Montserrat', sans-serif; overflow-x: hidden; }
        header { position: fixed; top: 0; left: 0; width: 100%; height: 130px; background: rgba(10, 15, 25, 0.95); backdrop-filter: blur(25px); border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .header-inner { width: 92%; max-width: 1500px; display: flex; justify-content: space-between; align-items: center; }
        .brand-wrap { display: flex; align-items: center; gap: 20px; }
        .logo-sphere { width: 65px; height: 65px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, var(--accent), var(--bright-blue)); box-shadow: 0 0 40px var(--accent), inset 0 0 20px rgba(255,255,255,0.5); border: 2px solid rgba(255,255,255,0.3); animation: pulse 2s infinite alternate; }
        @keyframes pulse { from { transform: scale(1); box-shadow: 0 0 30px var(--accent); } to { transform: scale(1.05); box-shadow: 0 0 50px var(--accent); } }
        .brand-text h1 { 
            font-family: 'Orbitron'; 
            font-size: 32px; 
            margin: 0; 
            letter-spacing: 6px; 
            font-weight: 900; 
            text-transform: uppercase; 
            line-height: 1; 
            color: #ffffff; 
        }
        .brand-text h1 span { 
            color: var(--accent); 
            text-shadow: 0 0 15px rgba(0, 255, 213, 0.4); 
        }
        .brand-text p { 
            font-size: 11px; 
            margin: 8px 0 0 0; 
            color: #8fa7c7; 
            letter-spacing: 5px; 
            text-transform: uppercase; 
            font-weight: 700; 
        }
        .nav-btn { background: none; border: 1px solid rgba(255,255,255,0.2); color: #fff; font-family: 'Orbitron'; font-size: 11px; font-weight: 700; cursor: pointer; padding: 8px 15px; border-radius: 5px; margin-right: 15px; }
        .wallet-btn { padding: 14px 32px; border-radius: 14px; border: none; background: linear-gradient(90deg, var(--accent), var(--bright-blue)); color: #000; font-family: 'Montserrat'; font-weight: 800; font-size: 13px; cursor: pointer; text-transform: uppercase; }
        .tg-btn { background: #24A1DE; color: white; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; margin-left: 15px; padding: 14px 24px; border-radius: 14px; font-weight: 800; font-size: 13px; font-family: 'Montserrat'; text-transform: uppercase; vertical-align: middle; }
        main { margin-top: 20px; padding-bottom: 300px; display: flex; justify-content: center; }
        #grid { display: grid; grid-template-columns: repeat(auto-fill, 120px); gap: 15px; width: 92%; max-width: 1500px; justify-content: center; }
        .tile { width: 120px; height: 120px; background: var(--glass); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 12px; cursor: pointer; position: relative; transition: 0.2s; }
        .tile.selected { border: 2px solid var(--accent) !important; box-shadow: 0 0 15px var(--accent) !important; z-index: 10; }
        .tile.sold { border: none; border-radius: 0; background-repeat: no-repeat; }
        #selection-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: auto; min-width: 400px; background: rgba(10, 15, 25, 0.95); border: 1px solid var(--accent); padding: 15px 30px; border-radius: 50px; backdrop-filter: blur(20px); z-index: 2000; display: none; justify-content: space-between; align-items: center; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }
        #data-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 10, 20, 0.9); backdrop-filter: blur(15px); display: none; align-items: center; justify-content: center; z-index: 3000; }
        .modal-box { width: 90%; max-width: 500px; background: #0a0f19; border: 1px solid var(--accent); padding: 40px; border-radius: 30px; }
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; font-family: 'Orbitron'; font-size: 10px; color: var(--accent); margin-bottom: 6px; }
        input { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 12px; border-radius: 10px; color: #fff; box-sizing: border-box; font-family: 'Montserrat', sans-serif; transition: all 0.3s ease; }
        input:focus { outline: none; border: 1px solid #00ffd5; box-shadow: 0 0 15px rgba(0, 255, 213, 0.3); background: rgba(0, 255, 213, 0.05); }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 10, 20, 0.95); backdrop-filter: blur(40px); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 5000; }
        .glass-panel { width: 90%; max-width: 1100px; padding: 60px; border-radius: 40px; background: rgba(10, 15, 25, 0.95); border: 1px solid rgba(255, 255, 255, 0.1); overflow-y: auto; max-height: 85vh; text-align: center; }
        .feature-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; margin-top: 50px; }
        .feature-item { background: rgba(255,255,255,0.02); padding: 35px; border-radius: 25px; border: 1px solid rgba(255,255,255,0.08); text-align: left; }
        .feature-item h3 { font-family: 'Orbitron'; color: var(--accent); font-size: 16px; margin-bottom: 20px; }
        .feature-item p { font-size: 14px; line-height: 1.8; color: #b0c4de; margin: 0; }
        .store-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; border-radius: 10px; background: rgba(255,255,255,0.05); color: #fff; text-decoration: none; font-family: 'Orbitron'; font-size: 12px; border: 1px solid rgba(255,255,255,0.1); text-align: center; }
        .store-btn:hover { background: var(--accent); color: #000; }
        #lite-paper { background: #0a0a0a; color: #cccccc; padding: 60px 20px; font-family: sans-serif; border-top: 1px solid #333; line-height: 1.8; max-width: 900px; margin: 60px auto 0; text-align: left; }
        #lite-paper h2 { color: #00ffcc; margin-bottom: 20px; font-size: 24px; }
        #lite-paper h3 { color: #00ffcc; margin-top: 30px; font-size: 20px; }
        #lite-paper ul { list-style: none; padding: 0; }
        #lite-paper li { margin-bottom: 12px; padding-left: 25px; position: relative; }
        #lite-paper li::before { content: "‚Üí"; position: absolute; left: 0; color: #00ffcc; }
        .contract-box { background: #1a1a1a; padding: 15px; border-radius: 5px; border: 1px dashed #444; word-break: break-all; font-family: monospace; color: #00ffcc; }
        .news-link a { color: #ffd700 !important; font-weight: 800; border: 1px solid #ffd700; padding: 6px 12px; border-radius: 50px; text-transform: uppercase; font-size: 0.85em; letter-spacing: 1px; margin-right: 15px; text-decoration: none; box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); animation: glow 2s infinite alternate; }
        @keyframes glow { from { box-shadow: 0 0 5px rgba(255, 215, 0, 0.2); } to { box-shadow: 0 0 15px rgba(255, 215, 0, 0.6); } }
        .tile:not(.sold) { background: rgba(0, 255, 213, 0.03); border: 1px solid rgba(0, 255, 213, 0.4); box-shadow: inset 0 0 15px rgba(0, 255, 213, 0.05), 0 0 10px rgba(0, 255, 213, 0.1); border-radius: 16px; position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; font-family: 'Orbitron', sans-serif; color: rgba(0, 255, 213, 0.8); font-size: 24px; font-weight: 700; backdrop-filter: blur(4px); transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .tile:not(.sold)::before { content: "+"; }
        .tile:not(.sold):hover { transform: translateY(-5px) scale(1.02); background: rgba(0, 255, 213, 0.05); border: 1px solid rgba(0, 255, 213, 0.8); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 255, 213, 0.4), inset 0 0 10px rgba(0, 255, 213, 0.2); color: #fff; cursor: pointer; z-index: 10; }
        .tile:not(.sold):hover::before { content: "CLAIM"; font-size: 11px; letter-spacing: 2px; }
        .tile.sold { border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 16px; background-size: cover; background-position: center; box-shadow: 0 5px 15px rgba(0,0,0,0.7), inset 0 0 0 1px rgba(255,255,255,0.1); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 5; }
        .tile.sold:hover { transform: scale(1.6) rotate(-2deg); box-shadow: 0 0 80px rgba(0, 255, 213, 0.9); z-index: 9999 !important; border: 2px solid #ffffff; cursor: zoom-in; }
        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: #050a14; }
        ::-webkit-scrollbar-thumb { background: #1a2a44; border: 1px solid #00ffcc; border-radius: 6px; }
        ::-webkit-scrollbar-thumb:hover { background: #00ffcc; box-shadow: 0 0 10px #00ffcc; }
        ::selection { background: #00ffcc; color: #000000; text-shadow: none; }
        @keyframes heartbeat { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 255, 213, 0.7); } 70% { transform: scale(1.05); box-shadow: 0 0 15px 5px rgba(0, 255, 213, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 255, 213, 0); } }
        .wallet-btn { animation: heartbeat 2s infinite; }
        .wallet-btn:hover { animation: none; transform: scale(1.1); box-shadow: 0 0 20px #00ffcc; }
        #social-proof { position: fixed; bottom: 30px; left: 30px; background: rgba(10, 15, 25, 0.95); border: 1px solid var(--accent); padding: 12px 20px; border-radius: 12px; backdrop-filter: blur(10px); display: none; align-items: center; gap: 12px; z-index: 4000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); font-size: 11px; font-family: 'Montserrat', sans-serif; animation: slideInUp 0.5s ease-out; }
        @keyframes slideInUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        #live-ticker { position: fixed; top: 0; left: 0; width: 100%; height: 35px; background: rgba(0, 255, 213, 0.05); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(0, 255, 213, 0.1); z-index: 999; display: flex; align-items: center; overflow: hidden; font-family: 'Montserrat', sans-serif; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #8fa7c7; position: relative; }
        .ticker-wrapper { display: flex; white-space: nowrap; animation: ticker-scroll 30s linear infinite; }
        .ticker-item { padding: 0 40px; display: flex; align-items: center; gap: 10px; }
        .ticker-item span { color: var(--accent); font-weight: 800; }
        @keyframes ticker-scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        .verified-glow { position: relative; border: 2px solid #ffd700 !important; box-shadow: 0 0 15px rgba(255, 215, 0, 0.6), 0 0 30px rgba(255, 215, 0, 0.2), inset 0 0 12px rgba(255, 215, 0, 0.3); z-index: 20; animation: goldPulse 2s infinite alternate; }
        @keyframes goldPulse { 0% { box-shadow: 0 0 12px rgba(255, 215, 0, 0.5); } 100% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.8), inset 0 0 15px rgba(255, 215, 0, 0.4); } }
        .verified-badge { position: absolute; top: -5px; right: -5px; width: 14px; height: 14px; background: linear-gradient(135deg, #ffd700, #ffaa00); color: #000; font-weight: 900; font-size: 9px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 3px rgba(0,0,0,0.5); border: 1px solid #fff; z-index: 30; cursor: help; }
        .verified-badge::after { content: "VERIFIED"; position: absolute; bottom: 150%; left: 50%; transform: translateX(-50%); background: #000; color: #00ffd5; padding: 2px 8px; border: 1px solid #ffd700; border-radius: 2px; font-family: 'Orbitron', sans-serif; font-size: 8px; letter-spacing: 1.5px; white-space: nowrap; opacity: 0; transition: opacity 0.2s ease; pointer-events: none; }
        .verified-badge:hover::after { opacity: 1; }
        @media (max-width: 768px) {
            #live-ticker { position: relative !important; top: 0 !important; margin: 10px 0; z-index: 1; }
            header { height: auto; padding: 15px 0; position: relative; display: flex; flex-direction: column; backdrop-filter: blur(15px); }
            #commission-ribbon { margin-top: 0 !important; padding: 15px 0 !important; background: rgba(0, 255, 213, 0.1); }
            .header-inner { flex-direction: column; gap: 10px; width: 95%; }
            .brand-wrap { gap: 10px; justify-content: center; }
            .logo-sphere { width: 45px; height: 45px; }
            .brand-text h1 { font-size: 18px; letter-spacing: 2px; text-align: center; }
            .brand-text p { font-size: 9px; letter-spacing: 3px; }
            .nav-group { display: flex; flex-direction: column; align-items: center; gap: 8px; width: 100%; }
            .nav-btn, .wallet-btn, .tg-btn { padding: 12px 20px; font-size: 11px; width: 85%; text-align: center; margin: 0; }
            main { margin-top: 20px; }
            #grid { grid-template-columns: repeat(auto-fill, 95px); gap: 10px; }
            .tile { width: 95px; height: 95px; }
            #selection-bar { width: 90%; min-width: unset; flex-direction: column; gap: 12px; bottom: 10px; padding: 20px; border-radius: 20px; }
            .modal-box { width: 85%; padding: 20px; max-height: 85vh; overflow-y: auto; border-radius: 20px; }
            .glass-panel { padding: 25px; }
            .feature-grid { grid-template-columns: 1fr; gap: 15px; }
        }
        @keyframes gpsPulse { 0% { box-shadow: 0 0 0 0 rgba(0, 255, 213, 0.7); border-color: #fff; } 70% { box-shadow: 0 0 0 20px rgba(0, 255, 213, 0); border-color: var(--accent); } 100% { box-shadow: 0 0 0 0 rgba(0, 255, 213, 0); border-color: #fff; } }
        .gps-target { animation: gpsPulse 2s infinite; z-index: 100 !important; position: relative; border: 2px solid #fff !important; }
    </style>
</head>
<body>
    <header>
        <div class="header-inner">
            <div class="brand-wrap"><div class="logo-sphere"></div><div class="brand-text"><h1>THE SOCIAL <span>GRID</span></h1><p>POWERED BY APERTUM</p></div></div>
            <div class="nav-group">
                <div style="width: 100%; text-align: center; margin-bottom: 10px;"><span class="news-link"><a href="https://explorer.apertum.io/" target="_blank">üöÄ 8,000,000+ TX ON APERTUM</a></span></div>
                <button class="nav-btn" onclick="openModal('how')">HOW IT WORKS</button>
                <button class="nav-btn" onclick="openModal('aff')">AFFILIATE PROGRAM</button>
                <button class="wallet-btn" onclick="connect()" id="w-btn">CONNECT WALLET</button>
                <a href="https://t.me/TheSocialGridOfficial" target="_blank" class="tg-btn"><img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" width="16"> HQ</a>
            </div>
        </div>
    </header>
    <div id="commission-ribbon" style="width: 100%; background: rgba(0, 255, 213, 0.05); border-bottom: 1px solid rgba(0, 255, 213, 0.1); padding: 12px 0; text-align: center; position: relative; margin-top: 130px; z-index: 900;">
        <span style="font-family:'Orbitron'; font-size:11px; color:#8fa7c7; letter-spacing:2px;"> COMMUNITY REWARDS DISTRIBUTED: <span id="live-comm-text" style="color:var(--accent); font-weight:800; font-size:16px; margin-left:10px; text-shadow: 0 0 10px var(--accent);"> 0.00 APTM </span></span>
    </div>
    <div id="live-ticker">
        <div class="ticker-wrapper" id="ticker-content">
            <div class="ticker-item">‚ö° RECENT TAKEOVER: <span>0x4f...2a</span> SECURED 4 BLOCKS (+1.0 APTM PROFIT)</div>
            <div class="ticker-item">üî• HOT ZONE: <span>SECTOR 7</span> IS SEEING HIGH ACTIVITY</div>
            <div class="ticker-item">üöÄ NETWORK: <span>8,402,192</span> TX VERIFIED ON APERTUM</div>
        </div>
    </div>
    <main><div id="grid"></div></main>
    <div id="selection-bar"><div style="font-family:'Orbitron'; font-size:14px;"><span id="select-count">0</span> Blocks | <span id="price-tag" style="color:var(--accent)">0 APTM</span></div><button onclick="cancelSelection()" style="background: rgba(255, 0, 0, 0.2); border: 1px solid #ff4444; color: #ff4444; width: 40px; height: 40px; border-radius: 12px; font-weight: bold; cursor: pointer; margin-right: 10px; font-size: 16px;">‚úï</button><button class="wallet-btn" style="padding: 10px 20px; font-size: 11px;" onclick="openDataModal()">ENTER DATA & BUY</button></div>
    <div id="data-modal">
        <div class="modal-box">
            <h3 style="font-family:'Orbitron'; color:var(--accent); margin-top:0;">SECURE TERRITORY</h3>
            <div class="input-group">
                <label style="display:flex; justify-content:space-between;"> IMAGE URL <a href="https://postimages.org/" target="_blank" style="color:var(--accent); text-decoration:none; font-size:9px; opacity:0.8;">‚Üó NEED AN UPLOAD LINK?</a></label>
                <input type="text" id="img-url" placeholder="Paste .jpg or .png link" oninput="validateImage(this)">
                <div id="link-warning" style="display:none; color:#ff2e63; font-size:10px; margin-top:5px; font-weight:800; font-family:'Montserrat', sans-serif;"> ‚ö†Ô∏è WAIT! That looks like a website, not an image. Link must end in .jpg or .png </div>
            </div>
            <div class="input-group"><label>MAIN WEBSITE</label><input type="text" id="main-link" placeholder="https://website.com"></div>
            <div class="input-group"><label>DAO / PARTNER</label><input type="text" id="ext-link" placeholder="Optional Link"></div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div class="input-group" style="grid-column: span 2;">
                    <label>ADVERTISER MESSAGE (MAX 100 CHARS)</label>
                    <input type="text" id="soc-link" placeholder="Example: Join the DAO1 revolution today!">
                </div>
                <div class="input-group" style="grid-column: span 2;">
                    <label>TELEGRAM</label>
                    <input type="text" id="tg-link" placeholder="t.me/group">
                </div>
            </div>
            <button class="wallet-btn" id="buy-btn" style="width:100%; margin-top:15px;" onclick="purchase()">FINALIZE PURCHASE</button>
            <button class="nav-btn" style="border:none; margin-top:15px; width:100%;" onclick="closeDataModal()">BACK TO GRID</button>
        </div>
    </div>
    <div id="overlay"><div class="glass-panel" id="modal-content"></div></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.6.1/web3.min.js"></script>
    <script>
        const CONTRACT_ADDR = "0xF0260a64e4b2D7d5E6dBD157E25dabaA869898df"; 
        const RPC_URL = "https://rpc.apertum.io/ext/bc/YDJ1r9RMkewATmA7B35q1bdV18aywzmdiXwd9zGBq3uQjsCnn/rpc";
        const ABI = [{"inputs":[{"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"internalType":"string","name":"img","type":"string"},{"internalType":"string","name":"m","type":"string"},{"internalType":"string","name":"e","type":"string"},{"internalType":"string","name":"s","type":"string"},{"internalType":"string","name":"t","type":"string"},{"internalType":"address","name":"referrer","type":"address"}],"name":"buyBlocks","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"grid","outputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"string","name":"imageUrl","type":"string"},{"internalType":"string","name":"linkUrl","type":"string"},{"internalType":"string","name":"metadata","type":"string"},{"internalType":"bool","name":"isSold","type":"bool"}],"stateMutability":"view","type":"function"}];
        
        let selected = []; let prices = {}; let userAccount = "";
        let web3Read = new Web3(new Web3.providers.HttpProvider(RPC_URL));
        let contractRead = new web3Read.eth.Contract(ABI, CONTRACT_ADDR);

        window.onload = async () => {
            const g = document.getElementById('grid');
            for (let i = 0; i < 1000; i++) {
                const d = document.createElement('div'); d.className = 'tile'; d.id = 'b-' + i; d.onclick = (e) => handleTileClick(i, e); g.appendChild(d);
            }
            loadGrid();
            if (localStorage.getItem('isWalletConnected') === 'true') { await connect(); }
        };

        async function loadGrid() {
    for(let i = 0; i < 500; i++) { 
        setTimeout(() => {
            contractRead.methods.grid(i).call().then(res => {
                if(res.isSold) {
                    const el = document.getElementById('b-' + i); 
                    if(!el) return;
                    el.classList.add('sold');
                    el.style.backgroundImage = "url('" + res.imageUrl + "')";
                    el.setAttribute('data-link', res.linkUrl);
                    el.setAttribute('data-img', res.imageUrl);
                    
                    const legacyData = {
                        owner: res.owner,
                        price: web3Read.utils.toWei("5", 'ether'),
                        imageUrl: res.imageUrl,
                        linkMain: res.linkUrl,
                        linkExternal: res.metadata,
                        linkSocial: "Verified Advertiser",
                        linkTelegram: "",
                        isSold: true
                    };
                    el.setAttribute('data-owner-info', JSON.stringify(legacyData));
                }
            }).catch(e => { });
        }, i * 2); 
    }
}

        function handleTileClick(id, event) {
            const el = document.getElementById('b-' + id);
            const isSold = el.classList.contains('sold');
            if (el.classList.contains('selected')) {
                el.classList.remove('selected'); selected = selected.filter(x => x !== id);
            } else {
                el.classList.add('selected'); selected.push(id);
                if(isSold) { showStorefront(JSON.parse(el.getAttribute('data-owner-info')), id); }
            }
            updateSelectionBar();
        }

        function updateSelectionBar() {
            const bar = document.getElementById('selection-bar');
            if(selected.length > 0) {
                bar.style.display = 'flex';
                let total = selected.reduce((sum, id) => sum + (prices[id] || 5), 0);
                document.getElementById('select-count').innerText = selected.length;
                document.getElementById('price-tag').innerHTML = `<span style="color:#fff; font-size:18px;">${total.toFixed(2)}</span> <span style="color:var(--accent); font-size:12px;">APTM</span>`;
            } else { bar.style.display = 'none'; }
        }

        function showStorefront(data, id) {
            const m = document.getElementById('overlay'); m.style.display = 'flex';
            const c = document.getElementById('modal-content');
            const gpsLink = window.location.origin + window.location.pathname + "?block=" + id;
            let partnerBtn = data.linkExternal ? `<a href="${data.linkExternal}" target="_blank" class="store-btn" style="border:1px dashed var(--accent);">ü§ù PARTNER / DAO</a>` : '';
            c.innerHTML = `<img src="${data.imageUrl}" style="width:150px; height:150px; border-radius:20px; border:2px solid var(--accent); margin-bottom:20px; object-fit:cover;">
                <h2 style="font-family:'Orbitron'; color:var(--accent); margin:0;">TERRITORY OWNER</h2>
                <p style="color:#8fa7c7; font-size:12px; margin-bottom:30px;">${data.owner}</p>
                <div style="background: rgba(255, 255, 255, 0.03); padding: 25px; border-radius: 12px; margin-bottom: 25px;">
                    <p style="color: var(--accent); font-size: 9px;">MESSAGE FROM ADVERTISER</p>
                    <p style="color: #fff; font-size: 14px;">${data.linkSocial || "Official Verified Advertiser."}</p>
                    <span style="background: rgba(255, 46, 99, 0.1); color: #ff2e63; padding: 5px 12px; border-radius: 20px; font-size: 11px;">‚öîÔ∏è TAKEOVER: ${(parseFloat(web3Read.utils.fromWei(data.price, 'ether')) * 1.5).toFixed(2)} APTM</span>
                </div>
                <a href="${data.linkMain}" target="_blank" class="store-btn">üåê VISIT MAIN WEBSITE</a>
                ${partnerBtn} 
                <a href="${data.linkTelegram}" target="_blank" class="store-btn" style="background: rgba(36, 161, 222, 0.1);">‚úàÔ∏è JOIN OFFICIAL TELEGRAM</a>
                <button class="store-btn" onclick="navigator.clipboard.writeText('${gpsLink}'); alert('GPS Link Copied!');">üìç COPY GPS LOCATION</button>
                <button class="wallet-btn" style="width:100%; margin-top:20px;" onclick="closeModal()">CLOSE [X]</button>`;
        }

        function cancelSelection() {
            selected.forEach(id => { const el = document.getElementById('b-' + id); if(el) el.classList.remove('selected'); });
            selected = []; document.getElementById('selection-bar').style.display = 'none';
        }

        async function purchase() {
            if(!userAccount) { alert("Connect wallet first!"); return; }
            const btn = document.getElementById('buy-btn');
            btn.innerText = "‚è≥ WAITING FOR WALLET...";
            const web3 = new Web3(window.ethereum);
            const contract = new web3.eth.Contract(ABI, CONTRACT_ADDR);
            let totalWei = selected.reduce((sum, id) => sum.add(web3.utils.toBN(web3.utils.toWei((prices[id] || 5).toString(), "ether"))), web3.utils.toBN(0));
            const urlParams = new URLSearchParams(window.location.search);
            const ref = urlParams.get('ref') || "0x0000000000000000000000000000000000000000";
            try {
                const tx = await contract.methods.buyBlocks(
                    selected, document.getElementById('img-url').value, document.getElementById('main-link').value,
                    document.getElementById('ext-link').value, document.getElementById('soc-link').value, 
                    document.getElementById('tg-link').value, ref
                ).send({ from: userAccount, value: totalWei.toString() });
                if (tx.status) { location.reload(); }
            } catch(e) { btn.innerText = "FINALIZE PURCHASE"; alert("Transaction Cancelled"); }
        }

        async function connect() {
            if (window.ethereum) {
                const accs = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAccount = accs[0];
                document.getElementById('w-btn').innerText = userAccount.substring(0,6)+"..."+userAccount.substring(38);
                localStorage.setItem('isWalletConnected', 'true');
            }
        }
        function openDataModal() { document.getElementById('data-modal').style.display = 'flex'; }
        function closeDataModal() { document.getElementById('data-modal').style.display = 'none'; }
        function closeModal() { document.getElementById('overlay').style.display = 'none'; }
        function openModal(t) {
            const m = document.getElementById('overlay'); m.style.display = 'flex';
            const c = document.getElementById('modal-content');
            if(t === 'how') {
                c.innerHTML = '<h2 style="color:var(--accent); font-family: Orbitron;">THE APERTUM PROTOCOL</h2><div class="feature-grid">' +
                '<div class="feature-item"><h3>üìç ADVERTISE</h3><p>Claim territory for 5 APTM per block.</p></div>' +
                '<div class="feature-item"><h3>‚öîÔ∏è WAR ZONE</h3><p>Takeover for 1.5x price.</p></div>' +
                '<div class="feature-item"><h3>üí∞ 120% RETURN</h3><p>Earn 20% profit on takeovers.</p></div></div><button class="wallet-btn" style="margin-top:40px; width:100%" onclick="closeModal()">CLOSE [X]</button>';
            }
        }
        function validateImage(field) {
            const val = field.value.toLowerCase().trim();
            const isValid = val.endsWith('.jpg') || val.endsWith('.png') || val.endsWith('.gif') || val.endsWith('.jpeg') || val.endsWith('.webp');
            document.getElementById('link-warning').style.display = isValid || val === "" ? 'none' : 'block';
        }
        window.addEventListener('click', function(e) { if (e.target.id === 'overlay' || e.target.id === 'data-modal') closeModal(); closeDataModal(); });
    </script>
    <section id="lite-paper">
        <h2>The Social Grid: Lite Paper</h2>
        <p>The Social Grid is a decentralized advertising economy built on the Apertum Network.</p>
        <div class="contract-box">0xF0260a64e4b2D7d5E6dBD157E25dabaA869898df</div>
    </section>
</body>
</html>


